<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Full Screen Overlays</title>
  <link rel="stylesheet" href="css/fullScreenOverlay.css">
  <link href="http://fonts.googleapis.com/css?family=Open+Sans:300" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fjalla+One&display=swap" rel="stylesheet">
</head>

<body>
    <div class="intermission">
        <img src="images/scorebug/intermission.png" id="intermission-img" width="1920"> <!--Might not end up using this :p-->
        <div class="players">
            <div class="blue-players">
                <h1 class="player blue" id="player-blue-1">playerName</h1>
                <h1 class="player blue" id="player-blue-2">playerName</h1>
                <h1 class="player blue" id="player-blue-3">playerName</h1>
            </div>
            <div class="orange-players">
                <h1 class="player orange" id="player-orange-1">playerName</h1>
                <h1 class="player orange" id="player-orange-2">playerName</h1>
                <h1 class="player orange" id="player-orange-3">playerName</h1>
            </div>
        </div>
        <div class="score-container">
            <div class="blue-score">
                <h2 class="score blue" id="score-blue-1">playerName</h2>
                <h2 class="score blue" id="score-blue-2">playerName</h2>
                <h2 class="score blue" id="score-blue-3">playerName</h2>
            </div>
            <div class="orange-score">
                <h2 class="score orange" id="score-orange-1">playerName</h2>
                <h2 class="score orange" id="score-orange-2">playerName</h2>
                <h2 class="score orange" id="score-orange-3">playerName</h2>
            </div>
        </div>
        <div class="goals-container">
            <div class="blue-goals">
                <h2 class="goals blue" id="goals-blue-1">playerName</h2>
                <h2 class="goals blue" id="goals-blue-2">playerName</h2>
                <h2 class="goals blue" id="goals-blue-3">playerName</h2>
            </div>
            <div class="orange-goals">
                <h2 class="goals orange" id="goals-orange-1">playerName</h2>
                <h2 class="goals orange" id="goals-orange-2">playerName</h2>
                <h2 class="goals orange" id="goals-orange-3">playerName</h2>
            </div>
        </div>
        <div class="saves-container">
            <div class="blue-saves">
                <h2 class="saves blue" id="saves-blue-1">playerName</h2>
                <h2 class="saves blue" id="saves-blue-2">playerName</h2>
                <h2 class="saves blue" id="saves-blue-3">playerName</h2>
            </div>
            <div class="orange-saves">
                <h2 class="saves orange" id="saves-orange-1">playerName</h2>
                <h2 class="saves orange" id="saves-orange-2">playerName</h2>
                <h2 class="saves orange" id="saves-orange-3">playerName</h2>
            </div>
        </div>
        <div class="assists-container">
            <div class="blue-assists">
                <h2 class="assists blue" id="assists-blue-1">playerName</h2>
                <h2 class="assists blue" id="assists-blue-2">playerName</h2>
                <h2 class="assists blue" id="assists-blue-3">playerName</h2>
            </div>
            <div class="orange-assists">
                <h2 class="assists orange" id="assists-orange-1">playerName</h2>
                <h2 class="assists orange" id="assists-orange-2">playerName</h2>
                <h2 class="assists orange" id="assists-orange-3">playerName</h2>
            </div>
        </div>
        <div class="shots-container">
            <div class="blue-shots">
                <h2 class="shots blue" id="shots-blue-1">playerName</h2>
                <h2 class="shots blue" id="shots-blue-2">playerName</h2>
                <h2 class="shots blue" id="shots-blue-3">playerName</h2>
            </div>
            <div class="orange-shots">
                <h2 class="shots orange" id="shots-orange-1">playerName</h2>
                <h2 class="shots orange" id="shots-orange-2">playerName</h2>
                <h2 class="shots orange" id="shots-orange-3">playerName</h2>
            </div>
        </div>
    </div>
    <div class="replay">
        <div id="goal-scorer-container" class="replay-text-container"><h1 id="goal-scorer" class="replay-h1">This is a long name</h1></div>
        <div id="assister-container" class="replay-text-container"><h1 id="assister" class="replay-h1">This is a long name</h1></div>
        <div id="time-taken-container" class="replay-text-container"><h1 id="time-taken" class="replay-h1">99:99</h1></div>
        <div id="goal-speed-container" class="replay-text-container"><h1 id="goal-speed" class="replay-h1">999kph</h1><h3 id="kph-identifier">  KPH</h3></div>
    </div>
    <div class="replay" id="replay-container">
        <img src="images/scorebug/replayOverlay - Blue.png" id="blueImg" class="replayImg" height="1080px" width="1920px">
        <img src="images/scorebug/replayOverlay - Orange.png" id="orangeImg" class="replayImg" height="1080px" width="1920px">
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script>
        const findPlayers = (playerGameObj, teamNum) => {
            let playerList = [];
            let teamNumList = [];
            let teamList = [];
            for(var item in playerGameObj) {
                if(playerGameObj.hasOwnProperty(item)) {
                    var value = playerGameObj[item];
                    playerList.push(item);
                }
            }
            for(var player in playerList) {
                let primePlayer = playerList[player];
                if (playerGameObj[primePlayer]['team'] == teamNum) {
                    teamNumList.push(playerList[player]);
                }
            }
            return teamNumList
        };
    </script>
    <script type="module">
        import { WsSubscribers } from './scripts/WS.js';

        

        $(() => {
            WsSubscribers.init(49322, true);

            WsSubscribers.subscribe("game", "replay_start", (d) => {
                //Replay items
                $('#replay-container').show();
                $('#replay-text-container').show();
                $('.replay-h1').show()
                $('#kph-identifier').show()
            });

            WsSubscribers.subscribe("game", "goal_scored", (d) => {
                let time_taken = d['goaltime'];
                if (d['goaltime'] < 60) {
                    $('#time-taken').text(new Date(time_taken * 1000).toISOString().substr(true ? 17 : 15, 4));
                } else {
                    $('#time-taken').text(new Date(time_taken * 1000).toISOString().substr(false ? 17 : 15, 4));
                }

                if (d['scorer']['teamnum'] === 0 ) {
                    $('#blueImg').show();
                    $('#orangeImg').hide();
                } else {
                    $('#orangeImg').show();
                    $('#blueImg').hide();
                }
                

                $('#goal-scorer').text(d['scorer']['name']);
                
                console.log(d['assister']['name']);
                $('#assister').text(d['assister']['name'] ? d['assister']['name'] : 'N/A');
                

                $('#goal-speed').text(Math.round(d['goalspeed'], 2));
            })

            WsSubscribers.subscribe("game", "replay_end", (d) => {
                //Replay items
                $('#replay-container').hide();
                $('#replay-text-container').hide();
                $('.replay-h1').hide()
                $('#kph-identifier').hide()
            });

            WsSubscribers.subscribe("game", "match_ended", (d) => {
                //Match Ended
                WsSubscribers.subscribe("game", "update_state", (e) => {
                    let teamOne = findPlayers(d['players'], 0);
                    let teamTwo = findPlayers(d['players'], 1);


                });
            });
        });
    </script>
</body>
</html>
