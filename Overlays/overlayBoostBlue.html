<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BoostBlue</title>
    <link rel="stylesheet" href="css/style2.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <div class="blueBoost">
        <div class="player 1">
            <img src="images/scorebug/boostOverlayBlue0.png" width="225px" class="boost-img" id="boost-1">
            <div id="meter-1" class="meter">
                <span style="width: 25%" id="value-1"></span>
            </div>
            <div class="name 1" id="name-1"> 
                <h1 id="name1">playerName</h1>
            </div>
            <div class="boost 1" id="boost-1">
                <h1 id="boost1">100</h1>
            </div>
        </div>
        <div class="player-2">
            <img src="images/scorebug/boostOverlayBlue0.png" width="225px" class="boost-img" id="boost-2">
            <div id="meter-2" class="meter">
                <span style="width: 25%" id="value-2"></span>
            </div>
            <div class="name 2" id="name-2">
                <h1 id="name2">playerName</h1>
            </div>
            <div class="boost 2" id="boost-2">
                <h1 id="boost2">100</h1>
            </div>
        </div>
        <div class="player-3">
            <img src="images/scorebug/boostOverlayBlue0.png" width="225px" class="boost-img" id="boost-3">
            <div id="meter-3" class="meter">
                <span style="width: 25%" id="value-3"></span>
            </div>
            <div class="name 3" id="name-3">
                <h1 id="name3">playerName</h1>
            </div>
            <div class="boost 3" id="boost-3">
                <h1 id="boost3">100</h1>
            </div>
        </div>
    </div>
    <script>
        const findPlayers = (playerGameObj, teamNum) => {
            let playerList = [];
            let teamNumList = [];
            let teamList = [];
            for(var item in playerGameObj) {
                if(playerGameObj.hasOwnProperty(item)) {
                    var value = playerGameObj[item];
                    playerList.push(item);
                }
            }
            for(var player in playerList) {
                let primePlayer = playerList[player];
                if (playerGameObj[primePlayer]['team'] == teamNum) {
                    teamNumList.push(playerList[player]);
                }
            }
            return teamNumList
        };
    </script>
    <script>
        const boostToWidth = (boostAmount, width, space) => {
            let conversion =  width / 100;
            let length = (boostAmount * conversion) + space;
            return length + 'px';
        }
    </script>
    <script type="module">
    import { WsSubscribers } from './scripts/WS.js';

    $(() => {
        WsSubscribers.init(49322, true);

        WsSubscribers.subscribe("game", "update_state", (d) => {
            let teamOne = findPlayers(d['players'], 0);
            let teamTwo = findPlayers(d['players'], 0);

            $('#name1').text(d['players'][teamOne[0]]['name']);
            $('#boost1').text(d['players'][teamOne[0]]['boost']);
            $("#value-1").animate({width: d['players'][teamOne[0]]['boost'] + '%'}, {duration: 90, easing: "linear"})
            
            if (teamOne[1] == true) {
                $('#name2').text(d['players'][teamOne[1]]['name']);
                $('#boost2').text(d['players'][teamOne[1]]['boost']);
                $("#value-2").animate({width: d['players'][teamOne[1]]['boost'] + '%'}, {duration: 90, easing: "linear"})
                $('.player-2').show();
            }
            if (teamOne[2] == true) {
                $('#name3').text(d['players'][teamOne[2]]['name']);
                $('#boost3').text(d['players'][teamOne[2]]['boost']);
                $("#value-3").animate({width: d['players'][teamOne[2]]['boost'] + '%'}, {duration: 90, easing: "linear"})
                $('.player-2').show();
            }

        });
        WsSubscribers.subscribe("game", "replay_start", (d) => {
            $('.blueBoost').animate({opacity: 0}, {duration: 75, easing: "linear"});
        });

        WsSubscribers.subscribe("game", "match_ended", (d) => {
            $('.blueBoost').animate({opacity: 0}, {duration: 75, easing: "linear"});
        });

        WsSubscribers.subscribe("game", "round_started_go", (d) => {
            $('.blueBoost').animate({opacity: 100}, {duration: 75, easing: "linear"});
        })
    });
    </script>
</body>
</html>